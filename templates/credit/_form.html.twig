{{ form_start(form) }}
    <div class="space-y-4 dark:text-gray-100">
        <div class="grid grid-cols-3 gap-4">
            <div>
                {{ form_label(form.documentId) }}
                {{ form_widget(form.documentId, {attr: {class: 'w-full'}}) }}
                {{ form_errors(form.documentId) }}
            </div>

            <div>
                {{ form_label(form.person) }}
                {{ form_widget(form.person, {attr: {class: 'w-full'}}) }}
                {{ form_errors(form.person) }}
            </div>

            <div>
                {{ form_label(form.billingPeriode) }}
                {{ form_widget(form.billingPeriode, {attr: {class: 'w-full'}}) }}
                {{ form_errors(form.billingPeriode) }}
            </div>
        </div>


        <div id="credit-items" data-prototype="{{ form_widget(form.creditItems.vars.prototype)|e('html_attr') }}" class="space-y-3">
            <div class="flex items-center justify-between">
                <label class="font-medium">Positionen</label>
                <button type="button" id="add-item" class="px-3 py-1 rounded bg-blue-600 text-white">+ Position hinzuf√ºgen</button>
            </div>
            {% for itemForm in form.creditItems %}
                <div class="border rounded p-3 space-y-2 credit-item">
                    <div class="grid grid-cols-6 gap-3">
                        <div>{{ form_row(itemForm.position) }}</div>
                        <div>{{ form_row(itemForm.name) }}</div>
                        <div>{{ form_row(itemForm.description) }}</div>
                        <div>{{ form_row(itemForm.quantity) }}</div>
                        <div>{{ form_row(itemForm.unit) }}</div>
                        <div>{{ form_row(itemForm.unitNetPrice) }}</div>
                        <div>{{ form_row(itemForm.taxRate) }}</div>
                        <div>{{ form_row(itemForm.taxAmount) }}</div>
                        <div>{{ form_row(itemForm.unitGrossPrice) }}</div>
                        <div>{{ form_row(itemForm.totalNet) }}</div>
                        <div>{{ form_row(itemForm.totalTax) }}</div>
                        <div>{{ form_row(itemForm.totalGross) }}</div>
                    </div>
                    <div class="text-right">
                        <button type="button" class="remove-item px-2 py-1 text-sm rounded bg-red-600 text-white">Entfernen</button>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div>
            <button class="px-4 py-2 rounded bg-green-600 text-white">Speichern</button>
        </div>
    </div>

    <script>
        (function() {
            const container = document.getElementById('credit-items');
            const addBtn = document.getElementById('add-item');
            let index = {{ form.creditItems|length }};

            function addItem() {
                const prototype = container.dataset.prototype;
                const html = prototype.replace(/__name__/g, index);
                index++;
                const wrapper = document.createElement('div');
                wrapper.className = 'border rounded p-3 space-y-2 credit-item';
                wrapper.innerHTML = html + '<div class="text-right mt-2"><button type="button" class="remove-item px-2 py-1 text-sm rounded bg-red-600 text-white">Entfernen</button></div>';
                container.appendChild(wrapper);
            }

            function onRemoveClick(e) {
                if (e.target && e.target.classList.contains('remove-item')) {
                    e.preventDefault();
                    const item = e.target.closest('.credit-item');
                    if (item) item.remove();
                }
            }

            if (addBtn) addBtn.addEventListener('click', addItem);
            container.addEventListener('click', onRemoveClick);
        })();
    </script>

{{ form_end(form) }}
